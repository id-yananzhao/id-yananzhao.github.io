{{- define "main" }}

{{- if .Site.Params.profileMode.enabled }}
{{- partial "index_profile.html" . }}
{{- end }}

{{- $allPages := where site.RegularPages "Section" "!=" "tickers" }}
{{- $allPages = $allPages.ByDate.Reverse }}
{{- $pages := slice }}
{{- if $allPages }}
{{- $latestDate := (index $allPages 0).Date }}
{{- range $allPages }}
{{- if eq (.Date.Format "2006-01-02") ($latestDate.Format "2006-01-02") }}
{{- $pages = $pages | append . }}
{{- end }}
{{- end }}
{{- end }}
{{- $paginator := .Paginate $pages }}

{{- if and .Site.Params.profileMode.enabled $paginator.Pages }}
<div class="post-content">
    <h2>Latest Reports</h2>
</div>
{{- end }}

{{- if $paginator.Pages }}
{{- range $paginator.Pages }}
<article class="post-entry">
    {{- $isHidden := .Params.cover.hidden | default site.Params.cover.hiddenInList | default site.Params.cover.hidden }}
    {{- if (and .Params.cover.image (not $isHidden)) }}
    <figure class="entry-cover">
        {{- $alt := (.Params.cover.alt | default .Params.cover.caption | default "") }}
        <img loading="lazy" src="{{ .Params.cover.image | absURL }}" alt="{{ $alt }}">
    </figure>
    {{- end }}
    <header class="entry-header">
        <h2 class="entry-hint-parent">{{ .Title }}
            {{- if .Draft }}<sup><span class="entry-hint" title="Draft">[draft]</span></sup>{{- end }}
        </h2>
    </header>
    {{- if (ne (.Param "hideSummary") true) }}
    <div class="entry-content">
        <p>{{ .Summary | plainify | htmlUnescape }}{{ if .Truncated }}...{{ end }}</p>
    </div>
    {{- end }}
    {{- if not (.Param "hideMeta") }}
    <footer class="entry-footer">{{- partial "post_meta.html" . -}}</footer>
    {{- end }}
    <a class="entry-link" aria-label="post link to {{ .Title | plainify }}" href="{{ .Permalink }}"></a>
</article>
{{- end }}

{{- if gt $paginator.TotalPages 1 }}
<footer class="page-footer">
    <nav class="pagination">
        {{- if $paginator.HasPrev }}
        <a class="prev" href="{{ $paginator.Prev.URL | absURL }}">
            «&nbsp;{{ i18n "prev_page" | default "Prev" }}
        </a>
        {{- end }}
        {{- if $paginator.HasNext }}
        <a class="next" href="{{ $paginator.Next.URL | absURL }}">
            {{ i18n "next_page" | default "Next" }}&nbsp;»
        </a>
        {{- end }}
    </nav>
</footer>
{{- end }}

{{- end }}

{{- end }}